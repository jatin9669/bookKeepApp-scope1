<% content_for :title, "My Books" %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="flex flex-col space-y-4 sm:space-y-0 sm:flex-row sm:justify-between sm:items-center mb-8">
    <h1 class="font-bold text-4xl text-gray-900">My Books</h1>
  </div>

  <div id="books" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
    <% if @books.any? %>
      <% @books.each do |book| %>
        <div class="space-y-3 <%= 'opacity-75' if @return_requests.pluck(:book_id).include?(book.id) %>">
          <%= render book %>
          <div class="px-2">
            <% if @return_requests.pluck(:book_id).include?(book.id) %>
              <button type="button" disabled
                  class="w-full rounded-md px-3 py-2 bg-green-400 text-white font-medium cursor-not-allowed">
                Return Requested
              </button>
            <% else %>
              <%= button_to "Request to Return", returned_books_path, 
                    params: { returned_book: { book_id: book.id, user_id: current_user.id } },
                    method: :post,
                    class: "w-full rounded-md px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white font-medium transition duration-150 ease-in-out" %>
            <% end %>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="col-span-full">
        <p class="text-center text-gray-500 text-lg my-10">No book Issued.</p>
      </div>
    <% end %>
  </div>
</div>
